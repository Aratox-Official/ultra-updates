<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>GoBattle Ultra Drops</title>
Â  Â  <style>
Â  Â  Â  Â  @font-face {
Â  Â  Â  Â  Â  Â  font-family: 'GoBattleCompass';
Â  Â  Â  Â  Â  Â  src: url('files/compass.ttf') format('truetype');
Â  Â  Â  Â  Â  Â  font-weight: normal;
Â  Â  Â  Â  Â  Â  font-style: normal;
Â  Â  Â  Â  }

Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'GoBattleCompass', Arial, sans-serif;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  background-color: #f4f4f4;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  background-image: url('files/gb_mountains_night.png');
Â  Â  Â  Â  Â  Â  background-size: cover;
Â  Â  Â  Â  Â  Â  background-position: center center;
Â  Â  Â  Â  Â  Â  background-repeat: no-repeat;
Â  Â  Â  Â  Â  Â  background-attachment: fixed;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .container {
Â  Â  Â  Â  Â  Â  max-width: 800px;
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  margin: 20px auto;
Â  Â  Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.95);
Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  color: #0056b3;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  font-size: 2.5em;
Â  Â  Â  Â  Â  Â  text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
Â  Â  Â  Â  }
Â  Â  Â  Â  .last-updated {
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  margin-bottom: 25px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .refresh-button {
Â  Â  Â  Â  Â  Â  display: inline-block;
Â  Â  Â  Â  Â  Â  margin: 0 auto 30px auto;
Â  Â  Â  Â  Â  Â  padding: 12px 25px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  background-color: #28a745;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  text-decoration: none;
Â  Â  Â  Â  Â  Â  transition: background-color 0.3s ease, transform 0.2s ease;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
Â  Â  Â  Â  }
Â  Â  Â  Â  .refresh-button:hover {
Â  Â  Â  Â  Â  Â  background-color: #218838;
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  }
Â  Â  Â  Â  .refresh-button:active {
Â  Â  Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  Â  }

Â  Â  Â  Â  #drops-list {
Â  Â  Â  Â  Â  Â  list-style: none;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  margin-top: 30px;
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(3, 1fr);
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @media (max-width: 600px) {
Â  Â  Â  Â  Â  Â  #drops-list {
Â  Â  Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(2, 1fr);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #drops-list li {
Â  Â  Â  Â  Â  Â  background-color: #e9ecef;
Â  Â  Â  Â  Â  Â  padding: 8px 10px;
Â  Â  Â  Â  Â  Â  border-radius: 6px;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s ease;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  Â  Â  min-height: 65px;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  #drops-list li.new-drop {
Â  Â  Â  Â  Â  Â  background-color: #ffda6a;
Â  Â  Â  Â  Â  Â  border: 2px solid #ff9900;
Â  Â  Â  Â  }

Â  Â  Â  Â  .ultra-name-group {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  line-height: 1.2;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .ultra-name-group strong {
Â  Â  Â  Â  Â  Â  color: #007bff;
Â  Â  Â  Â  Â  Â  font-weight: normal;
Â  Â  Â  Â  Â  Â  white-space: normal;Â 
Â  Â  Â  Â  Â  Â  word-wrap: break-word;Â 
Â  Â  Â  Â  Â  Â  overflow-wrap: break-word;
Â  Â  Â  Â  Â  Â  flex-grow: 1;
Â  Â  Â  Â  Â  Â  margin-left: 5px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .ultra-count {
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  align-self: flex-end;
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  bottom: 8px;
Â  Â  Â  Â  Â  Â  right: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .ultra-icon {
Â  Â  Â  Â  Â  Â  max-width: 28px;
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  Â  Â  vertical-align: top;Â 
Â  Â  Â  Â  Â  Â  margin-right: 0px;Â 
Â  Â  Â  Â  Â  Â  flex-shrink: 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .loading, .error {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 1.2em;
Â  Â  Â  Â  Â  Â  color: #666;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .error {
Â  Â  Â  Â  Â  Â  color: #dc3545;
Â  Â  Â  Â  }

Â  Â  Â  Â  .cookie-banner-overlay {
Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.8);
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  z-index: 1000;
Â  Â  Â  Â  }
Â  Â  Â  Â  .cookie-banner {
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  padding: 25px;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
Â  Â  Â  Â  Â  Â  max-width: 400px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .cookie-banner p {
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  line-height: 1.4;
Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  }
Â  Â  Â  Â  .cookie-banner button {
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  margin: 5px;
Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  font-family: 'GoBattleCompass', Arial, sans-serif;
Â  Â  Â  Â  Â  Â  font-size: 1em;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s;
Â  Â  Â  Â  }
Â  Â  Â  Â  .cookie-banner .accept {
Â  Â  Â  Â  Â  Â  background-color: #007bff;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }
Â  Â  Â  Â  .cookie-banner .decline {
Â  Â  Â  Â  Â  Â  background-color: #f0f0f0;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  }
Â  Â  Â  Â  .cookie-banner .accept:hover { background-color: #0056b3; }
Â  Â  Â  Â  .cookie-banner .decline:hover { background-color: #e0e0e0; }
Â  Â  </style>
</head>
<body>
Â  Â  <div id="cookie-banner-overlay" class="cookie-banner-overlay" style="display: none;">
Â  Â  Â  Â  <div class="cookie-banner">
Â  Â  Â  Â  Â  Â  <h2>Cookie Consent</h2>
Â  Â  Â  Â  Â  Â  <p>To enable the "New Drops Since Last Visit" feature, we need to store your current ultra drop count using a cookie. Do you accept cookies for enhanced tracking?</p>
Â  Â  Â  Â  Â  Â  <button class="accept" onclick="setCookiePreference(true)">Accept & Enable Tracking</button>
Â  Â  Â  Â  Â  Â  <button class="decline" onclick="setCookiePreference(false)">Decline & Use Basic View</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="container">
Â  Â  Â  Â  <h1>GoBattle Ultra Drops</h1>
Â  Â  Â  Â  <p class="last-updated" id="last-updated">Last updated: N/A</p>
Â  Â  Â  Â  <button class="refresh-button" onclick="fetchUltraDrops()">Refresh Drops</button>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div id="status-message" style="display: none; color: #dc3545; margin-bottom: 15px;"></div>

Â  Â  Â  Â  <div class="loading" id="loading-message">Loading ultra drops...</div>
Â  Â  Â  Â  <div class="error" id="error-message" style="display: none;">
Â  Â  Â  Â  Â  Â  Failed to load ultra drops. Please try again.
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <ul id="drops-list"></ul>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  let ultraData = [];
Â  Â  Â  Â  let useCookies = null;
Â  Â  Â  Â  let lastUltraDropsData = {};

Â  Â  Â  Â  const ULTRA_NAMES_PATH = 'files/ultra_names.json';
Â  Â  Â  Â  const DROPS_API_URL = 'https://gobattle-proxy.aratox-business.workers.dev';Â 
Â  Â  Â  Â  const COOKIE_NAME = 'site_consent';
Â  Â  Â  Â  const DROPS_COOKIE_NAME = 'site_ultra_drops';

Â  Â  Â  Â  // --- Cookie Functions ---
Â  Â  Â  Â  function getCookie(name) {
Â  Â  Â  Â  Â  Â  const nameEQ = name + "=";
Â  Â  Â  Â  Â  Â  const ca = document.cookie.split(';');
Â  Â  Â  Â  Â  Â  for (let i = 0; i < ca.length; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  let c = ca[i];
Â  Â  Â  Â  Â  Â  Â  Â  while (c.charAt(0) === ' ') c = c.substring(1, c.length);
Â  Â  Â  Â  Â  Â  Â  Â  if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  }

Â  Â  Â  Â  function setCookie(name, value, days) {
Â  Â  Â  Â  Â  Â  let expires = "";
Â  Â  Â  Â  Â  Â  if (days) {
Â  Â  Â  Â  Â  Â  Â  Â  const date = new Date();
Â  Â  Â  Â  Â  Â  Â  Â  date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
Â  Â  Â  Â  Â  Â  Â  Â  expires = "; expires=" + date.toUTCString();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
Â  Â  Â  Â  }

Â  Â  Â  Â  function deleteCookie(name) {
Â  Â  Â  Â  Â  Â  document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; SameSite=Lax";
Â  Â  Â  Â  }

Â  Â  Â  Â  function checkCookieConsent() {
Â  Â  Â  Â  Â  Â  const consent = getCookie(COOKIE_NAME);
Â  Â  Â  Â  Â  Â  const banner = document.getElementById('cookie-banner-overlay');

Â  Â  Â  Â  Â  Â  if (consent === null || consent === "") {
Â  Â  Â  Â  Â  Â  Â  Â  banner.style.display = 'flex';
Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  useCookies = (consent === 'accepted');
Â  Â  Â  Â  Â  Â  Â  Â  if (useCookies) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dropsData = getCookie(DROPS_COOKIE_NAME);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastUltraDropsData = dropsData ? JSON.parse(dropsData) : {};
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.setCookiePreference = function(accept) {
Â  Â  Â  Â  Â  Â  const banner = document.getElementById('cookie-banner-overlay');
Â  Â  Â  Â  Â  Â  useCookies = accept;
Â  Â  Â  Â  Â  Â  setCookie(COOKIE_NAME, accept ? 'accepted' : 'declined', 365);
Â  Â  Â  Â  Â  Â  banner.style.display = 'none';
Â  Â  Â  Â  Â  Â  fetchUltraDrops();
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Core Fetching Logic ---
Â  Â  Â  Â  async function fetchUltraNames() {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(ULTRA_NAMES_PATH);
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error(`Failed to fetch ultra names: ${response.statusText}`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return [];
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return await response.json();
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error loading local ultra names JSON:', error);
Â  Â  Â  Â  Â  Â  Â  Â  return [];Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  window.fetchUltraDrops = async function() {
Â  Â  Â  Â  Â  Â  if (useCookies === null) {
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const dropsList = document.getElementById('drops-list');
Â  Â  Â  Â  Â  Â  const loadingMessage = document.getElementById('loading-message');
Â  Â  Â  Â  Â  Â  const errorMessage = document.getElementById('error-message');
Â  Â  Â  Â  Â  Â  const lastUpdatedElement = document.getElementById('last-updated');
Â  Â  Â  Â  Â  Â  const statusMessage = document.getElementById('status-message');

Â  Â  Â  Â  Â  Â  dropsList.innerHTML = '';Â 
Â  Â  Â  Â  Â  Â  loadingMessage.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  errorMessage.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  statusMessage.style.display = 'none';
Â  Â  Â  Â  Â  Â  lastUpdatedElement.textContent = `Last updated: Loading...`;

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  if (ultraData.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ultraData = await fetchUltraNames();
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(DROPS_API_URL);
Â  Â  Â  Â  Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  throw new Error(`HTTP error! status: ${response.status}`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const currentDrops = data.drops || {};
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let newDropsCount = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let newDropsDetails = [];

Â  Â  Â  Â  Â  Â  Â  Â  if (useCookies && Object.keys(lastUltraDropsData).length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  for (const item_id in currentDrops) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const currentNbDrop = currentDrops[item_id] || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastNbDrop = lastUltraDropsData[item_id] || 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const droppedAmount = currentNbDrop - lastNbDrop;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (droppedAmount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newDropsCount += droppedAmount;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newDropsDetails.push({ item_id, droppedAmount });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const enrichedDrops = Object.entries(currentDrops).map(([item_id, nb_drop]) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ultra = ultraData.find(u => u.id == item_id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const points = ultra ? ultra.points : 0;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const isNew = newDropsDetails.find(d => d.item_id == item_id);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return { item_id, nb_drop, points, isNew };
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const sortedDrops = enrichedDrops.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (a.isNew && !b.isNew) return -1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (!a.isNew && b.isNew) return 1;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (b.points !== a.points) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return b.points - a.points;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return b.nb_drop - a.nb_drop;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  if (sortedDrops.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropsList.innerHTML = '<li>No ultra drops data found.</li>';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sortedDrops.forEach(dropItem => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const { item_id, nb_drop, isNew } = dropItem;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const defaultUltra = { name: `Unknown Ultra (ID: ${item_id})`, path: "" };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const ultra = ultraData.find(u => u.id == item_id) || defaultUltra;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iconHtml = ultra.pathÂ 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? `<img src="${ultra.path}" alt="${ultra.name}" class="ultra-icon">`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `<span class="ultra-icon">â“</span>`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const listItem = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let dropText = nb_drop;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let itemClass = '';

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isNew) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropText = `${nb_drop} (+${isNew.droppedAmount})`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  itemClass = 'new-drop';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.className = itemClass;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  listItem.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="ultra-name-group">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${iconHtml}<strong>${ultra.name}:</strong>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="ultra-count">${dropText}</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropsList.appendChild(listItem);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  lastUpdatedElement.textContent = `Last updated: ${new Date().toLocaleTimeString()} ${new Date().toLocaleDateString()}`;

Â  Â  Â  Â  Â  Â  Â  Â  if (useCookies) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (newDropsCount > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.textContent = `ğŸ‰ ${newDropsCount} new ultra drops since your last visit!`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.style.color = '#28a745';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (Object.keys(lastUltraDropsData).length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.textContent = `No new drops since your last visit.`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.style.color = '#007bff';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setCookie(DROPS_COOKIE_NAME, JSON.stringify(currentDrops), 365);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  lastUltraDropsData = currentDrops;
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.textContent = `Tracking disabled. Accept cookies to enable 'New Drops Since Last Visit' feature.`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.style.color = '#6c757d';Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Error fetching ultra drops:', error);
Â  Â  Â  Â  Â  Â  Â  Â  errorMessage.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  dropsList.innerHTML = '<li>An error occurred while fetching the drops data.</li>';
Â  Â  Â  Â  Â  Â  Â  Â  lastUpdatedElement.textContent = `Last updated: Failed to load`;
Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.style.display = 'none';
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  loadingMessage.style.display = 'none';Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Initialization ---
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  if (checkCookieConsent()) {
Â  Â  Â  Â  Â  Â  Â  Â  fetchUltraDrops();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>
